# AI_Docu_Verifier v5.5 - 시험성적서 검증 강화 업데이트

## 📋 업데이트 요약

**버전**: v5.5 (시험성적서 검증 강화)  
**날짜**: 2025-02-04  
**핵심 변경**: 규칙 30 시험성적서 검증 로직 대폭 강화

---

## 🔥 핵심 규칙 (규칙 30)

### ★★★ 필수 조건 ★★★
시험성적서는 **반드시** 다음 **두 가지 시험 항목이 모두** 포함되어 있어야 유효합니다:

1. **열방출시험** (Total Heat Release)
2. **가스유해성 시험** (Gas Toxicity)

### ★★★ 제외 대상 ★★★
**열전도율 시험**은 무조건 제외합니다:
- 열전도율 시험만 있는 시험성적서 → **무효** → 보완서류
- 열방출 + 가스유해성 + 열전도율 → 열전도율은 무시, 나머지로 판정

### ★★★ 예외 사항 ★★★
- 외벽 마감재가 **석재**(화강석, 대리석 등)인 경우 → 시험성적서 생략 가능
- 단, 석재도 **납품확인서는 필수**

---

## 📝 변경된 파일

### 1. `core/unified_pdf_analyzer.py`
- **시험성적서 분석 프롬프트 강화**
  - 열방출시험 키워드 확장: THR, HRR, 총열방출량, KS F ISO 5660 등
  - 가스유해성시험 키워드 확장: Gas Toxicity, KS F 2271, 마우스시험 등
  - 열전도율시험 키워드 확장: Thermal Conductivity, K-value, KS L 9016 등
  - 판단 로직 명확화

- **`_apply_test_certificate()` 함수 강화**
  - AI 분석 결과 + 텍스트 기반 이중 검증
  - detected_tests 텍스트 분석으로 누락 항목 보완 검출
  - 상세한 검증 로깅 추가

### 2. `core/enhanced_validation_engine.py`
- **규칙 30 검증 로직 전면 개선**
  - 열전도율만 있는 시험성적서 우선 필터링
  - 석재 예외 판정 강화 (다양한 석재 키워드)
  - 자재별 검증 메시지 상세화
  - 디버그 로깅 추가

### 3. `core/test_certificate_validator.py` (신규)
- 시험성적서 정밀 검증 전용 모듈
- 자재별 개별 시험성적서 추적
- 테스트 가능한 독립 검증 로직

### 4. `test_certificate_validation_v2.py` (신규)
- 10가지 검증 시나리오 테스트
- 모든 테스트 통과 확인

---

## 🧪 검증 키워드 목록

### 열방출시험 (유효)
```
열방출, 총열방출량, 열방출률, 열방출율, 열량방출
THR, Total Heat Release, Heat Release Rate, HRR
발열량, 발열율, 열에너지
Cone Calorimeter, 콘칼로리미터
KS F ISO 5660, ISO 5660, 5660
```

### 가스유해성시험 (유효)
```
가스유해성, 가스유해, 가스독성, 연소가스유해성, 연소가스
Gas Toxicity, Gas Toxic, Toxicity Test
유해가스, 유독가스, 연기독성, 연기유해성
KS F 2271, 2271
마우스, Mouse, 동물시험
```

### 열전도율시험 (제외)
```
열전도율, 열전도, 열전도계수, 단열성능, 단열시험
Thermal Conductivity, K-value, K값
KS L ISO 8302, KS L 9016, 8302, 9016
```

### 석재 키워드 (예외 적용)
```
석재, 화강석, 대리석, 현무암, 사암, 석회암
Granite, Marble, Stone
타일, 테라코타, 세라믹, 도자기, 자기질
```

---

## 📊 검증 판정 로직

| 열방출 | 가스유해성 | 열전도율 | 판정 |
|:---:|:---:|:---:|:---|
| ✅ | ✅ | - | ✅ 유효 |
| ✅ | ✅ | ✅ | ✅ 유효 (열전도율 무시) |
| ✅ | ❌ | - | ❌ 무효 (가스유해성 없음) |
| ❌ | ✅ | - | ❌ 무효 (열방출 없음) |
| ❌ | ❌ | ✅ | ❌ 무효 (열전도율만) ⚠️ |
| ❌ | ❌ | ❌ | ❌ 무효 (둘 다 없음) |

---

## 🚀 사용 방법

기존과 동일합니다. 시험성적서 파일이 포함된 문서 세트를 분석하면 자동으로 강화된 검증이 적용됩니다.

### 출력 예시

```
[준불연시험성적서·납품확인서 검증 (규칙 30)]
  📄 시험성적서 파일 제출: ✅ 제출됨
  📄 납품확인서 파일 제출: ✅ 제출됨

  [시험 항목 검증 - 열방출+가스유해성 조합 필수]
    ✅ 열방출시험: 포함됨
    ✅ 가스유해성 시험: 포함됨

    ★ 시험성적서 판정: ✅ 유효 (열방출+가스유해성 조합 충족)
```

### 열전도율만 있는 경우
```
  [시험 항목 검증 - 열방출+가스유해성 조합 필수]
    ❌ 열방출시험: 미포함
    ❌ 가스유해성 시험: 미포함
    ⚠️ 열전도율 시험: 포함됨 (★이 시험은 인정 안 됨)

    ★ 시험성적서 판정: ❌ 무효 (열전도율만 있음, 열방출+가스유해성 필요)
```

---

## ✅ 테스트 결과

10가지 시나리오 모두 통과:

1. ✅ 유효 (열방출 + 가스유해성)
2. ✅ 무효 (열전도율만 - 핵심 필터링)
3. ✅ 무효 (열방출만)
4. ✅ 무효 (가스유해성만)
5. ✅ 유효 (열방출 + 가스유해성 + 열전도율)
6. ✅ 무효 (시험 항목 없음)
7. ✅ 석재 예외 (시험성적서 불필요)
8. ✅ 영문 키워드 인식
9. ✅ KS 표준 번호 인식
10. ✅ 열전도율만 (다양한 표현)

---

## 📁 파일 목록

```
AI_Docu_Verifier_v5.5/
├── core/
│   ├── unified_pdf_analyzer.py      # 시험성적서 프롬프트 및 적용 로직 강화
│   ├── enhanced_validation_engine.py # 규칙 30 검증 로직 강화
│   ├── test_certificate_validator.py # 시험성적서 검증 전용 모듈 (신규)
│   └── ... (기타 파일)
├── test_certificate_validation_v2.py # 테스트 스크립트 (신규)
├── UPDATE_TEST_CERT_v5.5.md          # 이 문서
└── ... (기타 파일)
```
